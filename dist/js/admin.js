import{toast,toastError,confirmToast}from"./toast.js";import{API_BASE,getProfile}from"./api.js";let currentPage=1;const limit=10;let totalPages=1;function insertSearchAndPagination(){const e=document.querySelector("#pendingTable");if(!e)return;const t=document.createElement("input");t.type="text",t.id="search-input",t.className="admin__search",t.placeholder="Szukaj…";const n=document.createElement("div");n.className="pagination",n.innerHTML='\n    <button class="pagination__btn" id="prev-page">Poprzednia</button>\n    <span class="pagination__info" id="pagination-info">Strona 1 z 1</span>\n    <button class="pagination__btn" id="next-page">Następna</button>\n  ',e.parentElement.insertBefore(t,e),e.parentElement.appendChild(n)}function bindSearch(){document.getElementById("search-input")?.addEventListener("input",async()=>{currentPage=1,await loadPendingUsers()}),document.getElementById("prev-page")?.addEventListener("click",async()=>{currentPage>1&&(currentPage--,await loadPendingUsers())}),document.getElementById("next-page")?.addEventListener("click",async()=>{currentPage<totalPages&&(currentPage++,await loadPendingUsers())})}async function loadPendingUsers(){const e=document.getElementById("search-input")?.value||"";try{const t=await fetch(`${API_BASE}/api/admin/pending-users?search=${encodeURIComponent(e)}&page=${currentPage}&limit=10`,{credentials:"include"}),n=await t.json();if(!t.ok)throw new Error(n?.message||"Błąd ładowania wniosków");renderTable(n.pendingUsers||[]),updatePagination(n.total,n.page,n.totalPages)}catch(e){toastError(e.message||"Błąd pobierania danych")}}function renderTable(e=[]){const t=document.getElementById("pendingBody");t&&(t.innerHTML=e.length?e.map(e=>`\n        <tr>\n          <td>${e.username}</td>\n          <td>${e.email}</td>\n          <td>${e.role}</td>\n          <td>\n            <button class="btn--sm btn-approve" data-id="${e._id}">Zatwierdź</button>\n            <button class="btn--sm btn--danger btn-reject" data-id="${e._id}">Odrzuć</button>\n          </td>\n        </tr>\n      `).join(""):'<tr><td colspan="4">Brak wyników.</td></tr>',document.querySelectorAll(".btn-approve").forEach(e=>e.addEventListener("click",()=>handleDecision(e.dataset.id,!0))),document.querySelectorAll(".btn-reject").forEach(e=>e.addEventListener("click",()=>handleDecision(e.dataset.id,!1))))}function updatePagination(e,t,n){totalPages=n||1,currentPage=t||1;const a=document.querySelector(".pagination"),o=document.getElementById("pagination-info");a.style.display=totalPages>1?"flex":"none",o&&(o.textContent=`Strona ${currentPage} z ${totalPages}`),document.getElementById("prev-page").disabled=currentPage<=1,document.getElementById("next-page").disabled=currentPage>=totalPages}async function handleDecision(e,t){if(await confirmToast({message:t?"Zatwierdzić tego użytkownika?":"Odrzucić tego użytkownika?",okText:t?"Zatwierdź":"Odrzuć",cancelText:"Anuluj"}))try{const n=await fetch(`${API_BASE}/api/admin/${t?"approve":"reject"}/${e}`,{method:"POST",credentials:"include"}),a=await n.json();if(!n.ok)throw new Error(a?.message||"Błąd operacji");toast(t?"Zatwierdzono.":"Odrzucono.","success"),await loadPendingUsers()}catch(e){toastError(e.message||"Błąd operacji")}}document.addEventListener("DOMContentLoaded",async()=>{try{const e=await getProfile();if(!e||"admin"!==e.role)return void toastError("Brak dostępu");insertSearchAndPagination(),bindSearch(),await loadPendingUsers()}catch{toastError("Błąd ładowania danych administratora")}});
//# sourceMappingURL=admin.js.map
